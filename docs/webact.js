var Se=Object.defineProperty,ye=Object.defineProperties;var ge=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var ve=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var X=(r,t,a)=>t in r?Se(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,K=(r,t)=>{for(var a in t||(t={}))ve.call(t,a)&&X(r,a,t[a]);if(V)for(var a of V(t))we.call(t,a)&&X(r,a,t[a]);return r},k=(r,t)=>ye(r,ge(t));(function(){"use strict";if("adoptedStyleSheets"in document)return;var r="ShadyCSS"in window&&!window.ShadyCSS.nativeShadow,t=[],a=[],s=new WeakMap,f=new WeakMap,e=new WeakMap,m=new WeakMap,y=new WeakMap,_={loaded:!1},g={body:null,CSSStyleSheet:null},j=CSSStyleSheet,oe=/@import\surl(.*?);/gi;function $(n){return n instanceof j||n instanceof g.CSSStyleSheet}function ie(n,o){var i=o===document?"Document":"ShadowRoot";if(!Array.isArray(n))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+i+": Iterator getter is not callable.");if(!n.every($))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+i+": Failed to convert value to 'CSSStyleSheet'");var c=n.filter(function(h,d){return n.indexOf(h)===d});return s.set(o,c),c}function I(){return document.readyState==="loading"}function z(n){return s.get(n.parentNode===document.documentElement?document:n)}function B(n){var o=n.match(oe,"")||[],i=n;return o.length&&(console.warn("@import rules are not allowed here. See https://github.com/WICG/construct-stylesheets/issues/119#issuecomment-588352418"),o.forEach(function(c){i=i.replace(c,"")})),i}var ae=["addImport","addPageRule","addRule","deleteRule","insertRule","removeImport","removeRule"],ce=["replace","replaceSync"];function J(n){ce.forEach(function(o){n[o]=function(){return O.prototype[o].apply(this,arguments)}}),ae.forEach(function(o){var i=n[o];n[o]=function(){var c=arguments,h=i.apply(this,c);if(f.has(this)){var d=f.get(this),u=d.adopters,S=d.actions;u.forEach(function(p){p.sheet&&p.sheet[o].apply(p.sheet,c)}),S.push([o,c])}return h}})}function G(n){var o=f.get(n),i=o.adopters,c=o.basicStyleElement;i.forEach(function(h){h.innerHTML=c.innerHTML})}var O=function(){function n(){var i=document.createElement("style");_.loaded?g.body.appendChild(i):(document.head.appendChild(i),i.disabled=!0,t.push(i));var c=i.sheet;return f.set(c,{adopters:new Map,actions:[],basicStyleElement:i}),c}var o=n.prototype;return o.replace=function(c){var h=this,d=B(c);return new Promise(function(u,S){if(f.has(h)){var p=f.get(h),l=p.basicStyleElement;l.innerHTML=d,u(l.sheet),G(h)}else S(new Error("Can't call replace on non-constructed CSSStyleSheets."))})},o.replaceSync=function(c){var h=B(c);if(f.has(this)){var d=f.get(this),u=d.basicStyleElement;return u.innerHTML=h,G(this),u.sheet}else throw new Error("Failed to execute 'replaceSync' on 'CSSStyleSheet': Can't call replaceSync on non-constructed CSSStyleSheets.")},n}();Object.defineProperty(O,Symbol.hasInstance,{configurable:!0,value:$});function L(n){for(var o=document.createDocumentFragment(),i=z(n),c=m.get(n),h=0,d=i.length;h<d;h++){var u=f.get(i[h]),S=u.adopters,p=u.basicStyleElement,l=S.get(n);l?(c.disconnect(),o.appendChild(l),(!l.innerHTML||l.sheet&&!l.sheet.cssText)&&(l.innerHTML=p.innerHTML),c.observe()):(l=document.createElement("style"),l.innerHTML=p.innerHTML,e.set(l,n),y.set(l,0),S.set(n,l),o.appendChild(l)),n===document.head&&a.push(l)}n.insertBefore(o,n.firstChild);for(var w=0,D=i.length;w<D;w++){var C=f.get(i[w]),M=C.adopters,E=C.actions,b=M.get(n),ue=y.get(b);if(E.length>0){for(var H=ue,pe=E.length;H<pe;H++){var Q=E[H],fe=Q[0],me=Q[1];b.sheet[fe].apply(b.sheet,me)}y.set(b,E.length-1)}}}function he(n,o){for(var i=z(n),c=0,h=o.length;c<h;c++)if(!(i.indexOf(o[c])>-1)){var d=f.get(o[c]),u=d.adopters,S=m.get(n),p=u.get(n);p||(p=u.get(document.head)),S.disconnect(),p.parentNode.removeChild(p),S.observe()}}function de(n){for(var o=0,i=n.length;o<i;o++){for(var c=n[o],h=c.addedNodes,d=c.removedNodes,u=0,S=d.length;u<S;u++){var p=e.get(d[u]);p&&L(p)}if(!r)for(var l=0,w=h.length;l<w;l++)for(var D=document.createNodeIterator(h[l],NodeFilter.SHOW_ELEMENT,function(M){return M.shadowRoot&&M.shadowRoot.adoptedStyleSheets.length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},null,!1),C=void 0;C=D.nextNode();)L(C.shadowRoot)}}function Y(n){var o=new MutationObserver(de),i={observe:function(){o.observe(n,{childList:!0,subtree:!0})},disconnect:function(){o.disconnect()}};m.set(n,i),i.observe()}function Z(){var n=document.createElement("iframe");n.hidden=!0,document.body.appendChild(n),g.body=n.contentWindow.document.body,g.CSSStyleSheet=n.contentWindow.CSSStyleSheet,J(n.contentWindow.CSSStyleSheet.prototype),Y(document.body),_.loaded=!0;for(var o=document.createDocumentFragment(),i=0,c=t.length;i<c;i++)t[i].disabled=!1,o.appendChild(t[i]);g.body.appendChild(o);for(var h=0,d=a.length;h<d;h++)o.appendChild(a[h]);document.body.insertBefore(o,document.body.firstChild),t.length=0,a.length=0}function le(){var n={configurable:!0,get:function(){return s.get(this)||[]},set:function(c){var h=s.get(this)||[];ie(c,this);var d=this===document?I()?this.head:this.body:this,u="isConnected"in d?d.isConnected:document.body.contains(d);window.requestAnimationFrame(function(){u&&(L(d),he(d,h))})}};if(Object.defineProperty(Document.prototype,"adoptedStyleSheets",n),typeof ShadowRoot<"u"){var o=Element.prototype.attachShadow;Element.prototype.attachShadow=function(){var i=r?this:o.apply(this,arguments);return Y(i),i},Object.defineProperty(ShadowRoot.prototype,"adoptedStyleSheets",n)}}J(j.prototype),window.CSSStyleSheet=O,le(),I()?document.addEventListener("DOMContentLoaded",Z):Z()})();function Ce(r){return r.replace(/(-)([a-z])/g,t=>t[1].toUpperCase())}function x(r){return r.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function v(r){return r?Array.from(r).reduce((t,{localName:a,value:s})=>k(K({},t),{[Ce(a)]:s}),{}):{}}function F(r){return document.createRange().createContextualFragment(r)}function _e(){let r=new CSSStyleSheet;return r.replace(String.raw(...arguments)),r}function Me(){let r=document.createElement("style");return r.innerText=String.raw(...arguments),r}function N(r,...t){let a=!1;try{new CSSStyleSheet,a=!0}catch(s){a=!1}return a?_e(r,...t):Me(r,...t)}function ee(){return F(String.raw(...arguments))}var A={},Ee={},q=class extends HTMLElement{constructor(t){super(),t?this.componentPath=t:(console.warn("You did not send a path to the super method in your constructor. Thus CSS and HTML cannot be read for this component.",this),console.warn("If shipping for modern browser, then call super with import.meta.url. If not, specify a path that is similar to import.meta.url yourself."),console.warn("Should be the path to the component you are making."))}$(t){return this._sDOM.querySelector(t)}get cssPath(){return this.componentPath&&this.componentPath.replace(/\.(html|js)/gi,".css")}get htmlPath(){return this.componentPath&&this.componentPath.replace(/\.(css|js)/gi,".html")}get props(){return v(this.attributes)}async _render(){if(!Ee[this.cssPath]&&this.cssPath){let s=await this.fetchCSSAsStyleSheet();this._sDOM.adoptedStyleSheets=[s]}let a=this.render(this.props);return F(a)}async fetchHTMLAsDocFrag(){let t=await fetch(this.htmlPath);if(t.ok){let a=await t.text();return F(a)}throw new Error("Fetch failed")}async fetchCSSAsStyleSheet(){let t=new CSSStyleSheet,a=await fetch(this.cssPath);if(a.ok&&a.headers.get("content-type").indexOf("text/css")!==-1){let s=await a.text();await t.replace(s)}return t}async _renderHTMLFile(){let t=btoa(this.componentPath);A[t]||(A[t]=Promise.all([this.fetchHTMLAsDocFrag(),this.fetchCSSAsStyleSheet()]));let[a,s]=await A[t];return this._sDOM.adoptedStyleSheets=[s],a.cloneNode(!0)}componentDidMount(){}async connectedCallback(){this._sDOM=this.attachShadow({mode:"closed"});let t;this.render?t=await this._render():this.componentPath?t=await this._renderHTMLFile():console.error("No render function or component path found for static html/css."),this._sDOM.innerHTML=null,this._sDOM.appendChild(t),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.componentDidMount&&this.componentDidMount()})})}};function te(r,{name:t}={name:void 0}){let a="is"in r?r.is:r.prototype.constructor.name,s=t||x(a);return customElements.define(s,r),s}var ne=[],W=new Map,T=new Map,P=new Map,R=new Map,U=new Map,re=new Map;function be(r,{metaUrl:t,observedAttributes:a,name:s,shadowRootMode:f}){return class extends HTMLElement{constructor(){super(),this._postRender=void 0,this._propsChanged=void 0,this._hmrUpdate=!1,this._componentPath=t,this._hasRendered=!1,document.addEventListener("esm-hmr:webact-function-component",()=>{this._hmrUpdate=!0,r=W.has(s)?W.get(s):r,this._render()})}set _html(e){if(!T.has(s)||this._hmrUpdate){let m=document.createElement("template");m.content.appendChild(e),T.set(s,m)}}get _html(){return T.has(s)?T.get(s).content.cloneNode(!0):null}set _css(e){(!P.has(s)||this._hmrUpdate)&&P.set(s,e)}get _css(){return P.has(s)?P.get(s):null}get cssPath(){return this._componentPath&&this._componentPath.replace(/\.(html|js)/gi,".css")}get htmlPath(){return this._componentPath&&this._componentPath.replace(/\.(css|js)/gi,".html")}static get observedAttributes(){return a}async _render(e){this._rendering=r.apply(this.customThis,[e]),this._rendering instanceof Promise&&await this._rendering,this._css?("adoptedStyleSheets"in this._sDOM&&this._css instanceof CSSStyleSheet&&requestAnimationFrame(()=>{this._sDOM.adoptedStyleSheets=[this._css]}),this._css instanceof HTMLStyleElement&&this._sDOM.appendChild(this._css)):document.location.href.includes("localhost")&&console.warn(`<${s}>: Missing CSS. Will render without it.`),this._html?requestAnimationFrame(()=>this._sDOM.appendChild(this._html)):document.location.href.includes("localhost")&&console.warn(`<${s}>: Missing HTML. Will render without it.`),this._postRender instanceof Function&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{this._postRender(),this._hmrUpdate=!1,this._hasRendered=!0})})}get _props(){return v(this.attributes)}get customThis(){return{html:(e,...m)=>{if(!(this._html!==null&&this._hmrUpdate===!1))return this._html=ee(e,...m),this._html},css:(e,...m)=>{if(!(this._css!==null&&this._hmrUpdate===!1))return this._css=N(e,...m),this._css},useHTML:async e=>{if(U.has(s))return U.get(s);if(e=e||this.htmlPath,!e)return;e instanceof URL&&(e=e.toString());let y=(async()=>{let g=await(await fetch(e)).text();this.customThis.html`${g}`})();return U.set(s,y),y},useCSS:async e=>{if(R.has(s))return R.get(s);if(e=e||this.cssPath,!e)return;e instanceof URL&&(e=e.toString());let y=(async()=>{let g=await(await fetch(e)).text();this.customThis.css`${g}`,R.delete(s)})();return R.set(s,y),y},postRender:e=>{this._postRender=e},deRender:e=>{this._deRender=e},propsChanged:e=>{this._propsChanged=e},$:e=>e===void 0||e===":host"?this:e===":root"?this._sDOM:this._sDOM.querySelector(e),$$:e=>this._sDOM.querySelectorAll(e)}}async attributeChangedCallback(){this._rendering instanceof Promise&&await this._rendering,requestAnimationFrame(()=>{if(this._propsChanged instanceof Function){let e=JSON.stringify(v(this.attributes));if(re.get(s)===e)return;this._propsChanged(v(this.attributes)),re.set(s,e)}else document.location.href.includes("localhost")&&console.error(`
            <${s}>: Attribute has changed and you are observing attributes, but not handling them in a propsChanged handler.
            Remove observedAttributes or or actually use them.
          `)})}async connectedCallback(){this._sDOM=this.attachShadow({mode:f||"closed"}),this._render(this._props)}disconnectedCallback(){this._deRender&&this._deRender()}}}function se(r,{metaUrl:t,observedAttributes:a,name:s,shadowRootMode:f}={metaUrl:void 0,observedAttributes:[],name:void 0,shadowRootMode:"closed"}){let e=s||x(r.name);if(customElements.get(e))if(ne.includes(e))W.set(e,r),document.dispatchEvent(new CustomEvent("esm-hmr:webact-function-component"));else throw new Error(`
        Some else has already registered <${e}> in the custom element registry.
      `);else{let m=be(r,{metaUrl:t,observedAttributes:a,name:e,shadowRootMode:f});customElements.define(e,m),ne.push(e)}return e}export{q as Component,te as registerComponent,se as registerFunctionComponent};
//# sourceMappingURL=index.js.map
