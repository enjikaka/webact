(function(){"use strict";if("adoptedStyleSheets"in document)return;var a="ShadyCSS"in window&&!window.ShadyCSS.nativeShadow,n=[],c=[],i=new WeakMap,e=new WeakMap,l=new WeakMap,S=new WeakMap,F=new WeakMap,H={loaded:!1},y={body:null,CSSStyleSheet:null},j=CSSStyleSheet,X=/@import\surl(.*?);/gi;function q(t){return t instanceof j||t instanceof y.CSSStyleSheet}function K(t,r){var s=r===document?"Document":"ShadowRoot";if(!Array.isArray(t))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+s+": Iterator getter is not callable.");if(!t.every(q))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+s+": Failed to convert value to 'CSSStyleSheet'");var o=t.filter(function(h,d){return t.indexOf(h)===d});return i.set(r,o),o}function U(){return document.readyState==="loading"}function W(t){return i.get(t.parentNode===document.documentElement?document:t)}function I(t){var r=t.match(X,"")||[],s=t;return r.length&&(console.warn("@import rules are not allowed here. See https://github.com/WICG/construct-stylesheets/issues/119#issuecomment-588352418"),r.forEach(function(o){s=s.replace(o,"")})),s}var ee=["addImport","addPageRule","addRule","deleteRule","insertRule","removeImport","removeRule"],te=["replace","replaceSync"];function $(t){te.forEach(function(r){t[r]=function(){return P.prototype[r].apply(this,arguments)}}),ee.forEach(function(r){var s=t[r];t[r]=function(){var o=arguments,h=s.apply(this,o);if(e.has(this)){var d=e.get(this),p=d.adopters,m=d.actions;p.forEach(function(f){f.sheet&&f.sheet[r].apply(f.sheet,o)}),m.push([r,o])}return h}})}function k(t){var r=e.get(t),s=r.adopters,o=r.basicStyleElement;s.forEach(function(h){h.innerHTML=o.innerHTML})}var P=function(){function t(){var s=document.createElement("style");H.loaded?y.body.appendChild(s):(document.head.appendChild(s),s.disabled=!0,n.push(s));var o=s.sheet;return e.set(o,{adopters:new Map,actions:[],basicStyleElement:s}),o}var r=t.prototype;return r.replace=function(o){var h=this,d=I(o);return new Promise(function(p,m){if(e.has(h)){var f=e.get(h),u=f.basicStyleElement;u.innerHTML=d,p(u.sheet),k(h)}else m(new Error("Can't call replace on non-constructed CSSStyleSheets."))})},r.replaceSync=function(o){var h=I(o);if(e.has(this)){var d=e.get(this),p=d.basicStyleElement;return p.innerHTML=h,k(this),p.sheet}else throw new Error("Failed to execute 'replaceSync' on 'CSSStyleSheet': Can't call replaceSync on non-constructed CSSStyleSheets.")},t}();Object.defineProperty(P,Symbol.hasInstance,{configurable:!0,value:q});function L(t){for(var r=document.createDocumentFragment(),s=W(t),o=S.get(t),h=0,d=s.length;h<d;h++){var p=e.get(s[h]),m=p.adopters,f=p.basicStyleElement,u=m.get(t);u?(o.disconnect(),r.appendChild(u),(!u.innerHTML||u.sheet&&!u.sheet.cssText)&&(u.innerHTML=f.innerHTML),o.observe()):(u=document.createElement("style"),u.innerHTML=f.innerHTML,l.set(u,t),F.set(u,0),m.set(t,u),r.appendChild(u)),t===document.head&&c.push(u)}t.insertBefore(r,t.firstChild);for(var g=0,O=s.length;g<O;g++){var v=e.get(s[g]),C=v.adopters,b=v.actions,M=C.get(t),oe=F.get(M);if(b.length>0){for(var R=oe,ae=b.length;R<ae;R++){var N=b[R],ie=N[0],ce=N[1];M.sheet[ie].apply(M.sheet,ce)}F.set(M,b.length-1)}}}function ne(t,r){for(var s=W(t),o=0,h=r.length;o<h;o++)if(!(s.indexOf(r[o])>-1)){var d=e.get(r[o]),p=d.adopters,m=S.get(t),f=p.get(t);f||(f=p.get(document.head)),m.disconnect(),f.parentNode.removeChild(f),m.observe()}}function re(t){for(var r=0,s=t.length;r<s;r++){for(var o=t[r],h=o.addedNodes,d=o.removedNodes,p=0,m=d.length;p<m;p++){var f=l.get(d[p]);f&&L(f)}if(!a)for(var u=0,g=h.length;u<g;u++)for(var O=document.createNodeIterator(h[u],NodeFilter.SHOW_ELEMENT,function(C){return C.shadowRoot&&C.shadowRoot.adoptedStyleSheets.length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},null,!1),v=void 0;v=O.nextNode();)L(v.shadowRoot)}}function z(t){var r=new MutationObserver(re),s={observe:function(){r.observe(t,{childList:!0,subtree:!0})},disconnect:function(){r.disconnect()}};S.set(t,s),s.observe()}function B(){var t=document.createElement("iframe");t.hidden=!0,document.body.appendChild(t),y.body=t.contentWindow.document.body,y.CSSStyleSheet=t.contentWindow.CSSStyleSheet,$(t.contentWindow.CSSStyleSheet.prototype),z(document.body),H.loaded=!0;for(var r=document.createDocumentFragment(),s=0,o=n.length;s<o;s++)n[s].disabled=!1,r.appendChild(n[s]);y.body.appendChild(r);for(var h=0,d=c.length;h<d;h++)r.appendChild(c[h]);document.body.insertBefore(r,document.body.firstChild),n.length=0,c.length=0}function se(){var t={configurable:!0,get:function(){return i.get(this)||[]},set:function(o){var h=i.get(this)||[];K(o,this);var d=this===document?U()?this.head:this.body:this,p="isConnected"in d?d.isConnected:document.body.contains(d);window.requestAnimationFrame(function(){p&&(L(d),ne(d,h))})}};if(Object.defineProperty(Document.prototype,"adoptedStyleSheets",t),typeof ShadowRoot!="undefined"){var r=Element.prototype.attachShadow;Element.prototype.attachShadow=function(){var s=a?this:r.apply(this,arguments);return z(s),s},Object.defineProperty(ShadowRoot.prototype,"adoptedStyleSheets",t)}}$(j.prototype),window.CSSStyleSheet=P,se(),U()?document.addEventListener("DOMContentLoaded",B):B()})();function he(a){return a.replace(/(-)([a-z])/g,n=>n[1].toUpperCase())}function _(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function w(a){return a?Array.from(a).reduce((n,{localName:c,value:i})=>({...n,[he(c)]:i}),{}):{}}function E(a){return document.createRange().createContextualFragment(a)}function G(a,...n){let c=Array.isArray(a)?a.reduce((e,l,S)=>e+(n[S]?l+n[S]:l),""):a,i=new CSSStyleSheet;return i.replace(c),i}function J(a,...n){let c=Array.isArray(a)?a.reduce((i,e,l)=>i+(n[l]?e+n[l]:e),""):a;return E(c)}var D={},de={},Y=class extends HTMLElement{constructor(n){super();n?this.componentPath=n:(console.warn("You did not send a path to the super method in your constructor. Thus CSS and HTML cannot be read for this component.",this),console.warn("If shipping for modern browser, then call super with import.meta.url. If not, specify a path that is similar to import.meta.url yourself."),console.warn("Should be the path to the component you are making."))}$(n){return this._sDOM.querySelector(n)}get cssPath(){return this.componentPath&&this.componentPath.replace(/\.(html|js)/gi,".css")}get htmlPath(){return this.componentPath&&this.componentPath.replace(/\.(css|js)/gi,".html")}get props(){return w(this.attributes)}async _render(){if(!de[this.cssPath]&&this.cssPath){let i=await this.fetchCSSAsStyleSheet();this._sDOM.adoptedStyleSheets=[i]}let c=this.render(this.props);return E(c)}async fetchHTMLAsDocFrag(){let n=await fetch(this.htmlPath);if(n.ok){let c=await n.text();return E(c)}throw new Error("Fetch failed")}async fetchCSSAsStyleSheet(){let n=new CSSStyleSheet,c=await fetch(this.cssPath);if(c.ok&&c.headers.get("content-type").indexOf("text/css")!==-1){let i=await c.text();await n.replace(i)}return n}async _renderHTMLFile(){let n=btoa(this.componentPath);D[n]||(D[n]=Promise.all([this.fetchHTMLAsDocFrag(),this.fetchCSSAsStyleSheet()]));let[c,i]=await D[n];return this._sDOM.adoptedStyleSheets=[i],c.cloneNode(!0)}componentDidMount(){}async connectedCallback(){this._sDOM=this.attachShadow({mode:"closed"});let n;this.render?n=await this._render():this.componentPath?n=await this._renderHTMLFile():console.error("No render function or component path found for static html/css."),this._sDOM.innerHTML=null,this._sDOM.appendChild(n),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.componentDidMount&&this.componentDidMount()})})}};function Z(a){let n="is"in a?a.is:a.prototype.constructor.name,c=_(n);return customElements.define(c,a),c}var Q=[],A=new Map,x=new Map,T=new Map;function ue(a,{metaUrl:n,observedAttributes:c,kebabName:i}){return class extends HTMLElement{constructor(){super();this._htmlFetch=void 0,this._cssFetch=void 0,this._postRender=void 0,this._propsChanged=void 0,this._hmrUpdate=!1,this._componentPath=n,document.addEventListener("esm-hmr:webact-function-component",()=>{this._hmrUpdate=!0,a=A.has(i)?A.get(i):a,this._render()})}set _html(e){if(!x.has(i)||this._hmrUpdate){let l=document.createElement("template");l.content.appendChild(e),x.set(i,l)}}get _html(){return x.has(i)?x.get(i).content.cloneNode(!0):null}set _css(e){(!T.has(i)||this._hmrUpdate)&&T.set(i,e)}get _css(){return T.has(i)?T.get(i):null}get cssPath(){return this._componentPath&&this._componentPath.replace(/\.(html|js)/gi,".css")}get htmlPath(){return this._componentPath&&this._componentPath.replace(/\.(css|js)/gi,".html")}static get observedAttributes(){return c}async _render(e){this._rendering=a.apply(this.customThis,[e]),this._rendering instanceof Promise&&await this._rendering,this._css?requestAnimationFrame(()=>{this._sDOM.adoptedStyleSheets=[this._css]}):console.warn(`<${i}>: Missing CSS. Will render without it.`),this._html?requestAnimationFrame(()=>this._sDOM.appendChild(this._html)):console.warn(`<${i}>: Missing HTML. Will render without it.`),this._postRender instanceof Function&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{this._postRender(),this._hmrUpdate=!1})})}get customThis(){return{html:(e,...l)=>{if(!(this._html!==null&&this._hmrUpdate===!1))return this._html=J(e,...l),this._html},css:(e,...l)=>{if(!(this._css!==null&&this._hmrUpdate===!1))return this._css=G(e,...l),this._css},useHTML:async e=>{if(e=e||this.htmlPath,!e)return;e instanceof URL&&(e=e.toString());let S=await(await fetch(e)).text();this.customThis.html([S])},useCSS:async e=>{if(e=e||this.cssPath,!e)return;e instanceof URL&&(e=e.toString());let S=await(await fetch(e)).text();this.customThis.css([S])},postRender:e=>{this._postRender=e},propsChanged:e=>{this._propsChanged=e},$:e=>e===void 0||e===":host"?this:e===":root"?this._sDOM:this._sDOM.querySelector(e),$$:e=>this._sDOM.querySelectorAll(e)}}async attributeChangedCallback(){await this._rendering,requestAnimationFrame(()=>{this._propsChanged instanceof Function?this._propsChanged(w(this.attributes)):console.error(`
            <${i}>: Attribute has changed and you are observing attributes, but not handling them in a propsChanged handler.
            Remove observedAttributes or or actually use them.
          `)})}async connectedCallback(){this._sDOM=this.attachShadow({mode:"closed"}),this._render(w(this.attributes))}}}function V(a,{metaUrl:n,observedAttributes:c,name:i}={metaUrl:void 0,observedAttributes:[],name:void 0}){let e=i||_(a.name);if(customElements.get(e))if(Q.includes(e))A.set(e,a),document.dispatchEvent(new CustomEvent("esm-hmr:webact-function-component"));else throw new Error(`
        Some else has already registered <${e}> in the custom element registry.
      `);else{let l=ue(a,{metaUrl:n,observedAttributes:c,kebabName:e});customElements.define(e,l),Q.push(e)}return e}export{Y as Component,Z as registerComponent,V as registerFunctionComponent};
//# sourceMappingURL=index.js.map
