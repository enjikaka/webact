var me=Object.defineProperty;var Se=Object.prototype.hasOwnProperty;var V=Object.getOwnPropertySymbols,ye=Object.prototype.propertyIsEnumerable;var X=(s,t,o)=>t in s?me(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o,H=(s,t)=>{for(var o in t||(t={}))Se.call(t,o)&&X(s,o,t[o]);if(V)for(var o of V(t))ye.call(t,o)&&X(s,o,t[o]);return s};(function(){"use strict";if("adoptedStyleSheets"in document)return;var s="ShadyCSS"in window&&!window.ShadyCSS.nativeShadow,t=[],o=[],r=new WeakMap,e=new WeakMap,l=new WeakMap,m=new WeakMap,v=new WeakMap,y={loaded:!1},C={body:null,CSSStyleSheet:null},W=CSSStyleSheet,se=/@import\surl(.*?);/gi;function I(n){return n instanceof W||n instanceof C.CSSStyleSheet}function oe(n,i){var a=i===document?"Document":"ShadowRoot";if(!Array.isArray(n))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+a+": Iterator getter is not callable.");if(!n.every(I))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+a+": Failed to convert value to 'CSSStyleSheet'");var c=n.filter(function(h,d){return n.indexOf(h)===d});return r.set(i,c),c}function $(){return document.readyState==="loading"}function z(n){return r.get(n.parentNode===document.documentElement?document:n)}function B(n){var i=n.match(se,"")||[],a=n;return i.length&&(console.warn("@import rules are not allowed here. See https://github.com/WICG/construct-stylesheets/issues/119#issuecomment-588352418"),i.forEach(function(c){a=a.replace(c,"")})),a}var ie=["addImport","addPageRule","addRule","deleteRule","insertRule","removeImport","removeRule"],ae=["replace","replaceSync"];function J(n){ae.forEach(function(i){n[i]=function(){return O.prototype[i].apply(this,arguments)}}),ie.forEach(function(i){var a=n[i];n[i]=function(){var c=arguments,h=a.apply(this,c);if(e.has(this)){var d=e.get(this),p=d.adopters,S=d.actions;p.forEach(function(f){f.sheet&&f.sheet[i].apply(f.sheet,c)}),S.push([i,c])}return h}})}function G(n){var i=e.get(n),a=i.adopters,c=i.basicStyleElement;a.forEach(function(h){h.innerHTML=c.innerHTML})}var O=function(){function n(){var a=document.createElement("style");y.loaded?C.body.appendChild(a):(document.head.appendChild(a),a.disabled=!0,t.push(a));var c=a.sheet;return e.set(c,{adopters:new Map,actions:[],basicStyleElement:a}),c}var i=n.prototype;return i.replace=function(c){var h=this,d=B(c);return new Promise(function(p,S){if(e.has(h)){var f=e.get(h),u=f.basicStyleElement;u.innerHTML=d,p(u.sheet),G(h)}else S(new Error("Can't call replace on non-constructed CSSStyleSheets."))})},i.replaceSync=function(c){var h=B(c);if(e.has(this)){var d=e.get(this),p=d.basicStyleElement;return p.innerHTML=h,G(this),p.sheet}else throw new Error("Failed to execute 'replaceSync' on 'CSSStyleSheet': Can't call replaceSync on non-constructed CSSStyleSheets.")},n}();Object.defineProperty(O,Symbol.hasInstance,{configurable:!0,value:I});function L(n){for(var i=document.createDocumentFragment(),a=z(n),c=m.get(n),h=0,d=a.length;h<d;h++){var p=e.get(a[h]),S=p.adopters,f=p.basicStyleElement,u=S.get(n);u?(c.disconnect(),i.appendChild(u),(!u.innerHTML||u.sheet&&!u.sheet.cssText)&&(u.innerHTML=f.innerHTML),c.observe()):(u=document.createElement("style"),u.innerHTML=f.innerHTML,l.set(u,n),v.set(u,0),S.set(n,u),i.appendChild(u)),n===document.head&&o.push(u)}n.insertBefore(i,n.firstChild);for(var w=0,D=a.length;w<D;w++){var _=e.get(a[w]),M=_.adopters,x=_.actions,b=M.get(n),le=v.get(b);if(x.length>0){for(var A=le,ue=x.length;A<ue;A++){var Q=x[A],pe=Q[0],fe=Q[1];b.sheet[pe].apply(b.sheet,fe)}v.set(b,x.length-1)}}}function ce(n,i){for(var a=z(n),c=0,h=i.length;c<h;c++)if(!(a.indexOf(i[c])>-1)){var d=e.get(i[c]),p=d.adopters,S=m.get(n),f=p.get(n);f||(f=p.get(document.head)),S.disconnect(),f.parentNode.removeChild(f),S.observe()}}function he(n){for(var i=0,a=n.length;i<a;i++){for(var c=n[i],h=c.addedNodes,d=c.removedNodes,p=0,S=d.length;p<S;p++){var f=l.get(d[p]);f&&L(f)}if(!s)for(var u=0,w=h.length;u<w;u++)for(var D=document.createNodeIterator(h[u],NodeFilter.SHOW_ELEMENT,function(M){return M.shadowRoot&&M.shadowRoot.adoptedStyleSheets.length>0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},null,!1),_=void 0;_=D.nextNode();)L(_.shadowRoot)}}function Y(n){var i=new MutationObserver(he),a={observe:function(){i.observe(n,{childList:!0,subtree:!0})},disconnect:function(){i.disconnect()}};m.set(n,a),a.observe()}function Z(){var n=document.createElement("iframe");n.hidden=!0,document.body.appendChild(n),C.body=n.contentWindow.document.body,C.CSSStyleSheet=n.contentWindow.CSSStyleSheet,J(n.contentWindow.CSSStyleSheet.prototype),Y(document.body),y.loaded=!0;for(var i=document.createDocumentFragment(),a=0,c=t.length;a<c;a++)t[a].disabled=!1,i.appendChild(t[a]);C.body.appendChild(i);for(var h=0,d=o.length;h<d;h++)i.appendChild(o[h]);document.body.insertBefore(i,document.body.firstChild),t.length=0,o.length=0}function de(){var n={configurable:!0,get:function(){return r.get(this)||[]},set:function(c){var h=r.get(this)||[];oe(c,this);var d=this===document?$()?this.head:this.body:this,p="isConnected"in d?d.isConnected:document.body.contains(d);window.requestAnimationFrame(function(){p&&(L(d),ce(d,h))})}};if(Object.defineProperty(Document.prototype,"adoptedStyleSheets",n),typeof ShadowRoot!="undefined"){var i=Element.prototype.attachShadow;Element.prototype.attachShadow=function(){var a=s?this:i.apply(this,arguments);return Y(a),a},Object.defineProperty(ShadowRoot.prototype,"adoptedStyleSheets",n)}}J(W.prototype),window.CSSStyleSheet=O,de(),$()?document.addEventListener("DOMContentLoaded",Z):Z()})();function ge(s){return s.replace(/(-)([a-z])/g,t=>t[1].toUpperCase())}function E(s){return s.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function g(s){return s?Array.from(s).reduce((t,{localName:o,value:r})=>H(H({},t),{[ge(o)]:r}),{}):{}}function F(s){return document.createRange().createContextualFragment(s)}function ve(s,...t){let o=Array.isArray(s)?s.reduce((e,l,m)=>e+(t[m]?l+t[m]:l),""):s,r=new CSSStyleSheet;return r.replace(o),r}function Ce(s,...t){let o=Array.isArray(s)?s.reduce((e,l,m)=>e+(t[m]?l+t[m]:l),""):s,r=document.createElement("style");return r.innerText=o,r}function K(s,...t){let o=!1;try{let r=new CSSStyleSheet;o=!0}catch(r){o=!1}return o?ve(s,...t):Ce(s,...t)}function k(s,...t){let o=Array.isArray(s)?s.reduce((r,e,l)=>r+(t[l]?e+t[l]:e),""):s;return F(o)}var j={},we={},N=class extends HTMLElement{constructor(t){super();t?this.componentPath=t:(console.warn("You did not send a path to the super method in your constructor. Thus CSS and HTML cannot be read for this component.",this),console.warn("If shipping for modern browser, then call super with import.meta.url. If not, specify a path that is similar to import.meta.url yourself."),console.warn("Should be the path to the component you are making."))}$(t){return this._sDOM.querySelector(t)}get cssPath(){return this.componentPath&&this.componentPath.replace(/\.(html|js)/gi,".css")}get htmlPath(){return this.componentPath&&this.componentPath.replace(/\.(css|js)/gi,".html")}get props(){return g(this.attributes)}async _render(){if(!we[this.cssPath]&&this.cssPath){let r=await this.fetchCSSAsStyleSheet();this._sDOM.adoptedStyleSheets=[r]}let o=this.render(this.props);return F(o)}async fetchHTMLAsDocFrag(){let t=await fetch(this.htmlPath);if(t.ok){let o=await t.text();return F(o)}throw new Error("Fetch failed")}async fetchCSSAsStyleSheet(){let t=new CSSStyleSheet,o=await fetch(this.cssPath);if(o.ok&&o.headers.get("content-type").indexOf("text/css")!==-1){let r=await o.text();await t.replace(r)}return t}async _renderHTMLFile(){let t=btoa(this.componentPath);j[t]||(j[t]=Promise.all([this.fetchHTMLAsDocFrag(),this.fetchCSSAsStyleSheet()]));let[o,r]=await j[t];return this._sDOM.adoptedStyleSheets=[r],o.cloneNode(!0)}componentDidMount(){}async connectedCallback(){this._sDOM=this.attachShadow({mode:"closed"});let t;this.render?t=await this._render():this.componentPath?t=await this._renderHTMLFile():console.error("No render function or component path found for static html/css."),this._sDOM.innerHTML=null,this._sDOM.appendChild(t),requestAnimationFrame(()=>{requestAnimationFrame(()=>{this.componentDidMount&&this.componentDidMount()})})}};function ee(s,{name:t}={name:void 0}){let o="is"in s?s.is:s.prototype.constructor.name,r=t||E(o);return customElements.define(r,s),r}var te=[],q=new Map,T=new Map,P=new Map,R=new Map,U=new Map,ne=new Map;function _e(s,{metaUrl:t,observedAttributes:o,kebabName:r}){return class extends HTMLElement{constructor(){super();this._postRender=void 0,this._propsChanged=void 0,this._hmrUpdate=!1,this._componentPath=t,this._hasRendered=!1,document.addEventListener("esm-hmr:webact-function-component",()=>{this._hmrUpdate=!0,s=q.has(r)?q.get(r):s,this._render()})}set _html(e){if(!T.has(r)||this._hmrUpdate){let l=document.createElement("template");l.content.appendChild(e),T.set(r,l)}}get _html(){return T.has(r)?T.get(r).content.cloneNode(!0):null}set _css(e){(!P.has(r)||this._hmrUpdate)&&P.set(r,e)}get _css(){return P.has(r)?P.get(r):null}get cssPath(){return this._componentPath&&this._componentPath.replace(/\.(html|js)/gi,".css")}get htmlPath(){return this._componentPath&&this._componentPath.replace(/\.(css|js)/gi,".html")}static get observedAttributes(){return o}async _render(e){this._rendering=s.apply(this.customThis,[e]),this._rendering instanceof Promise&&await this._rendering,this._css?("adoptedStyleSheets"in this._sDOM&&this._css instanceof CSSStyleSheet&&requestAnimationFrame(()=>{this._sDOM.adoptedStyleSheets=[this._css]}),this._css instanceof HTMLStyleElement&&this._sDOM.appendChild(this._css)):document.location.href.includes("localhost")&&console.warn(`<${r}>: Missing CSS. Will render without it.`),this._html?requestAnimationFrame(()=>this._sDOM.appendChild(this._html)):document.location.href.includes("localhost")&&console.warn(`<${r}>: Missing HTML. Will render without it.`),this._postRender instanceof Function&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{this._postRender(),this._hmrUpdate=!1,this._hasRendered=!0})})}get _props(){return g(this.attributes)}get customThis(){return{html:(e,...l)=>{if(!(this._html!==null&&this._hmrUpdate===!1))return this._html=k(e,...l),this._html},css:(e,...l)=>{if(!(this._css!==null&&this._hmrUpdate===!1))return this._css=K(e,...l),this._css},useHTML:async e=>{if(U.has(r))return U.get(r);if(e=e||this.htmlPath,!e)return;e instanceof URL&&(e=e.toString());let m=(async()=>{let y=await(await fetch(e)).text();this.customThis.html([y])})();return U.set(r,m),m},useCSS:async e=>{if(R.has(r))return R.get(r);if(e=e||this.cssPath,!e)return;e instanceof URL&&(e=e.toString());let m=(async()=>{let y=await(await fetch(e)).text();this.customThis.css([y]),R.delete(r)})();return R.set(r,m),m},postRender:e=>{this._postRender=e},deRender:e=>{this._deRender=e},propsChanged:e=>{this._propsChanged=e},$:e=>e===void 0||e===":host"?this:e===":root"?this._sDOM:this._sDOM.querySelector(e),$$:e=>this._sDOM.querySelectorAll(e)}}async attributeChangedCallback(){this._rendering instanceof Promise&&await this._rendering,requestAnimationFrame(()=>{if(this._propsChanged instanceof Function){let e=JSON.stringify(g(this.attributes));if(ne.get(r)===e)return;this._propsChanged(g(this.attributes)),ne.set(r,e)}else document.location.href.includes("localhost")&&console.error(`
            <${r}>: Attribute has changed and you are observing attributes, but not handling them in a propsChanged handler.
            Remove observedAttributes or or actually use them.
          `)})}async connectedCallback(){this._sDOM=this.attachShadow({mode:"closed"}),this._render(this._props)}disconnectedCallback(){this._deRender&&this._deRender()}}}function re(s,{metaUrl:t,observedAttributes:o,name:r}={metaUrl:void 0,observedAttributes:[],name:void 0}){let e=r||E(s.name);if(customElements.get(e))if(te.includes(e))q.set(e,s),document.dispatchEvent(new CustomEvent("esm-hmr:webact-function-component"));else throw new Error(`
        Some else has already registered <${e}> in the custom element registry.
      `);else{let l=_e(s,{metaUrl:t,observedAttributes:o,kebabName:e});customElements.define(e,l),te.push(e)}return e}export{N as Component,ee as registerComponent,re as registerFunctionComponent};
//# sourceMappingURL=index.js.map
