var M=Object.freeze,v=Object.defineProperty;var _=(n,e)=>M(v(n,"raw",{value:M(e||n.slice())}));function F(n){return n.replace(/(-)([a-z])/g,e=>e[1].toUpperCase())}function p(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function u(n){return n?Array.from(n).reduce((e,{localName:r,value:s})=>Object.assign(e,{[F(r)]:s}),{}):{}}function P(n){return document.createRange().createContextualFragment(n)}function S(n,...e){let r=new CSSStyleSheet;return r.replace(String.raw(n,...e)),r}var d=class{constructor(e){this.root=e,this.byType=new Map}on(e,r,s,a){this.byType.has(e)||(this.byType.set(e,[]),this.root.addEventListener(e,this,a)),this.byType.get(e).push({selector:r,fn:s})}offAll(){for(let e of this.byType.keys())this.root.removeEventListener(e,this);this.byType.clear()}handleEvent(e){var s,a,t;let r=this.byType.get(e.type);if(r)for(let{selector:o,fn:c}of r){let l=(a=(s=e.target)==null?void 0:s.closest)==null?void 0:a.call(s,o);l&&(this.root===((t=l.getRootNode)==null?void 0:t.call(l))||this.root.contains(l))&&c.call(l,e)}}};var i=new Map,h=new Map;var y=class n extends HTMLElement{constructor(e){super(),e?this.componentPath=e:(console.warn("You did not send a path to the super method in your constructor. Thus CSS and HTML cannot be read for this component.",this),console.warn("If shipping for modern browser, then call super with import.meta.url. If not, specify a path that is similar to import.meta.url yourself."),console.warn("Should be the path to the component you are making."))}render(e){}deRender(){}$(e){return this._sDOM.querySelector(e)}get cssPath(){var e;return(e=this.componentPath)==null?void 0:e.replace(/\.(html|js)/gi,".css")}get htmlPath(){var e;return(e=this.componentPath)==null?void 0:e.replace(/\.(css|js)/gi,".html")}get props(){return u(this.attributes)}async _render(){var s;(s=this._events)==null||s.offAll();let e=await this.fetchCSSAsStyleSheet();this._sDOM.adoptedStyleSheets=[e];let r=this.render(this.props);return P(r)}_deRender(){this.deRender&&this.deRender()}async fetchHTMLAsDocFrag(){if(h.has(this.htmlPath))return h.get(this.htmlPath).cloneNode(!0);let e=await fetch(this.htmlPath);if(e.ok&&e.headers.get("content-type").includes("text/html")){let r=await e.text(),s=document.createElement("template");s.innerHTML=r;let a=s.content;return h.set(this.htmlPath,s),a}throw new Error("Fetch failed")}async fetchCSSAsStyleSheet(){if(i.has(this.cssPath))return i.get(this.cssPath);let e=new CSSStyleSheet,r=await fetch(this.cssPath);if(r.ok&&r.headers.get("content-type").includes("text/css")){let s=await r.text();await e.replace(s),i.set(this.cssPath,e)}return e}async _renderHTMLFile(){let[e,r]=await Promise.all([this.fetchHTMLAsDocFrag(),this.fetchCSSAsStyleSheet()]);return this._sDOM.adoptedStyleSheets=[r],e.cloneNode(!0)}componentDidMount(){}on(e,r,s,a){return this._events.on(e,r,s,a)}offAll(){this._events.offAll()}async connectedCallback(){this._sDOM=this.attachShadow({mode:"closed"}),this._events=new d(this._sDOM);let e;this.render!==n.prototype.render?e=await this._render():this.componentPath?e=await this._renderHTMLFile():console.error("No render function or component path found for static html/css."),this._sDOM.innerHTML="",this._sDOM.appendChild(e),this.componentDidMount&&queueMicrotask(()=>this.componentDidMount())}disconnectedCallback(){var e;(e=this._events)==null||e.offAll(),this._deRender&&this._deRender()}};function T(n,{name:e}={name:void 0}){let r="is"in n?n.is:n.prototype.constructor.name,s=e||p(r);return customElements.define(s,n),s}var x=[],w=new Map,f=new Map,g=new Map,A=new Map,R,b;function L(n,{metaUrl:e,observedAttributes:r,name:s,shadowRootMode:a}){return class extends HTMLElement{constructor(){super(),this._postRender=void 0,this._propsChanged=void 0,this._hmrUpdate=!1,this._componentPath=e,this._customThis=null,this._hasRendered=!1,document.addEventListener("esm-hmr:webact-function-component",()=>{this._hmrUpdate=!0,n=w.has(s)?w.get(s):n,this._render(this._props)})}set _html(t){if(!h.has(this.htmlPath)||this._hmrUpdate){let o=document.createElement("template");o.content.appendChild(t),h.set(this.htmlPath,o)}}get _html(){return h.has(this.htmlPath)?h.get(this.htmlPath).cloneNode(!0):null}set _css(t){(!i.has(this.htmlPath)||this._hmrUpdate)&&i.set(this.htmlPath,t)}get _css(){return i.has(this.htmlPath)?i.get(this.htmlPath):null}get cssPath(){var t;return(t=this._componentPath)==null?void 0:t.replace(/\.(html|js)/gi,".css")}get htmlPath(){var t;return(t=this._componentPath)==null?void 0:t.replace(/\.(css|js)/gi,".html")}static get observedAttributes(){return r}async _render(t){var o;(o=this._events)==null||o.offAll(),this._rendering=n.apply(this.customThis,[t]),this._rendering instanceof Promise&&await this._rendering,requestAnimationFrame(()=>{i.has(this.cssPath)?"adoptedStyleSheets"in this._sDOM&&(this._sDOM.adoptedStyleSheets=[i.get(this.cssPath)]):document.location.href.includes("localhost")&&console.warn("<".concat(s,">: Missing CSS. Will render without it.")),h.has(this.htmlPath)?this._sDOM.appendChild(h.get(this.htmlPath).cloneNode(!0)):document.location.href.includes("localhost")&&console.warn("<".concat(s,">: Missing HTML. Will render without it.")),this._postRender instanceof Function&&requestAnimationFrame(()=>{this._postRender(),this._hmrUpdate=!1,this._hasRendered=!0})})}get _props(){return u(this.attributes)}get customThis(){return this._customThis?this._customThis:(this._customThis={html:(t,...o)=>{if(h.has(this.htmlPath)&&this._hmrUpdate===!1)return;let c=document.createElement("template");return c.innerHTML=String.raw(t,...o),h.set(this.htmlPath,c),h.get(this.htmlPath).cloneNode(!0)},css:(t,...o)=>{if(!(i.has(this.cssPath)&&this._hmrUpdate===!1))return i.set(this.cssPath,S(t,...o)),i.get(this.cssPath)},useHTML:t=>{if(f.has(s))return f.get(s);if(t=t||this.htmlPath,!t)return;t instanceof URL&&(t=t.toString());let c=(async()=>{let m=await(await fetch(t)).text();this.customThis.html(R||(R=_(["",""])),m),f.delete(s);let C=document.createElement("template");C.innerHTML=m,h.set(this.htmlPath,C)})();return f.set(s,c),c},useCSS:t=>{if(g.has(s))return g.get(s);if(t=t||this.cssPath,!t)return;t instanceof URL&&(t=t.toString());let c=(async()=>{let m=await(await fetch(t)).text();i.set(this.cssPath,S(b||(b=_(["",""])),m)),g.delete(s)})();return g.set(s,c),c},postRender:t=>{this._postRender=t},deRender:t=>{this._deRender=t},propsChanged:t=>{this._propsChanged=t},$:t=>t===void 0||t===":host"?this:t===":root"?this._sDOM:this._sDOM.querySelector(t),$$:t=>this._sDOM.querySelectorAll(t),on:(t,o,c,l)=>this._events.on(t,o,c,l),offAll:()=>this._events.offAll()},this._customThis)}async attributeChangedCallback(){if(this._rendering instanceof Promise&&await this._rendering,this._propsChanged instanceof Function){let t=JSON.stringify(u(this.attributes));if(A.get(s)===t)return;requestAnimationFrame(()=>{this._propsChanged(u(this.attributes)),A.set(s,t)})}else document.location.href.includes("localhost")&&console.error("\n          <".concat(s,">: Attribute has changed and you are observing attributes, but not handling them in a propsChanged handler.\n          Remove observedAttributes or or actually use them.\n        "))}connectedCallback(){this._sDOM=this.attachShadow({mode:a||"closed"}),this._events=new d(this._sDOM),this._render(this._props)}disconnectedCallback(){var t;(t=this._events)==null||t.offAll(),this._deRender&&this._deRender()}}}function E(n,{metaUrl:e,observedAttributes:r,name:s,shadowRootMode:a}={metaUrl:void 0,observedAttributes:[],name:void 0,shadowRootMode:"closed"}){let t=s||p(n.name);if(customElements.get(t))if(x.includes(t))w.set(t,n),document.dispatchEvent(new CustomEvent("esm-hmr:webact-function-component"));else throw new Error("\n        Some else has already registered <".concat(t,"> in the custom element registry.\n      "));else{let o=L(n,{metaUrl:e,observedAttributes:r,name:t,shadowRootMode:a});customElements.define(t,o),x.push(t)}return t}export{y as Component,T as registerComponent,E as registerFunctionComponent};
//# sourceMappingURL=index.js.map
